# Google ADK Tutorial Test Plan

このドキュメントは、Google Agent Development Kit (ADK) チュートリアルの包括的なテスト計画を提供します。

## 1. テスト目標

- Google ADKの基本機能が正しく動作することを確認する
- Model Contexts Protocol (MCP) の実装が正しく機能することを確認する
- オープンソースMCP実装（lastmile-ai/mcp-agent）との統合が正しく機能することを確認する
- すべてのデモシナリオが期待通りに動作することを確認する
- エラー処理とエッジケースが適切に処理されることを確認する
- ドキュメントとコード例が一致していることを確認する

## 2. テスト環境

- Python 3.8以上
- 必要なパッケージ：
  - google-generativeai>=0.8.0
  - mcp-agent>=0.1.0（オプション、オープンソースMCPテスト用）
- 環境変数：
  - GOOGLE_API_KEY（オプション、実際のAPIリクエスト用）

## 3. テスト種類

### 3.1 ユニットテスト

| テストID | テスト名 | 説明 | 期待される結果 |
|----------|---------|------|--------------|
| UT-01 | 基本エージェント作成テスト | 基本的なエージェントの作成をテストする | エージェントが正しく作成され、プロパティが期待通りに設定される |
| UT-02 | エージェントメッセージ処理テスト | エージェントのメッセージ処理をテストする | エージェントがメッセージを正しく処理し、応答を返す |
| UT-03 | ツール作成テスト | ツールの作成をテストする | ツールが正しく作成され、プロパティが期待通りに設定される |
| UT-04 | ツール実行テスト | ツールの実行をテストする | ツールが正しく実行され、結果を返す |
| UT-05 | コンテキスト作成テスト | コンテキストの作成をテストする | コンテキストが正しく作成され、プロパティが期待通りに設定される |
| UT-06 | コンテキスト値設定・取得テスト | コンテキストの値の設定と取得をテストする | 値が正しく設定され、取得できる |
| UT-07 | アクティブコンテキストテスト | アクティブコンテキストの設定と取得をテストする | アクティブコンテキストが正しく設定され、取得できる |
| UT-08 | コンテキスト一覧テスト | コンテキスト一覧の取得をテストする | すべてのコンテキストが正しく一覧表示される |
| UT-09 | コンテキスト削除テスト | コンテキストの削除をテストする | コンテキストが正しく削除される |
| UT-10 | オープンソースMCPインポートテスト | オープンソースMCPのインポートをテストする | MCPモジュールが正しくインポートされる |

### 3.2 統合テスト

| テストID | テスト名 | 説明 | 期待される結果 |
|----------|---------|------|--------------|
| IT-01 | 基本エージェントデモテスト | 基本的なエージェントのデモをテストする | デモが正しく実行され、エラーなく完了する |
| IT-02 | ツールエージェントデモテスト | ツールを使用するエージェントのデモをテストする | デモが正しく実行され、ツールが正しく機能する |
| IT-03 | コンテキストエージェントデモテスト | コンテキスト管理を活用したエージェントのデモをテストする | デモが正しく実行され、コンテキストが正しく維持される |
| IT-04 | MCPエージェントデモテスト | MCPを使用するエージェントのデモをテストする | デモが正しく実行され、MCPが正しく機能する |
| IT-05 | オープンソースMCPエージェントデモテスト | オープンソースMCPを使用するエージェントのデモをテストする | デモが正しく実行され、オープンソースMCPが正しく機能する |
| IT-06 | すべてのデモテスト | すべてのデモを一度に実行するテスト | すべてのデモが正しく実行され、エラーなく完了する |

### 3.3 エラー処理テスト

| テストID | テスト名 | 説明 | 期待される結果 |
|----------|---------|------|--------------|
| ET-01 | APIキーなしテスト | APIキーなしでデモを実行するテスト | シミュレーションモードで正しく実行される |
| ET-02 | 無効なパラメータテスト | 無効なパラメータでツールを実行するテスト | 適切なエラーメッセージが表示される |
| ET-03 | 存在しないコンテキストテスト | 存在しないコンテキストにアクセスするテスト | 適切なエラーメッセージが表示される |
| ET-04 | 存在しないキーテスト | 存在しないキーの値を取得するテスト | 適切なエラーメッセージが表示され、Noneが返される |
| ET-05 | 無効なモデル名テスト | 無効なモデル名でエージェントを作成するテスト | 適切なエラーメッセージが表示される |

### 3.4 ドキュメントテスト

| テストID | テスト名 | 説明 | 期待される結果 |
|----------|---------|------|--------------|
| DT-01 | READMEコード例テスト | READMEのコード例をテストする | コード例が正しく実行される |
| DT-02 | ドキュメントとコードの一致テスト | ドキュメントとコードが一致しているかテストする | ドキュメントとコードが一致している |
| DT-03 | 例のインポートテスト | 例のインポートをテストする | 例が正しくインポートされる |

## 4. テスト実行計画

1. ユニットテストの実行：
   ```
   cd python_tutorial/tests
   python -m unittest test_adk.py
   ```

2. 統合テストの実行：
   ```
   cd python_tutorial/src/google_adk
   python main_tutorial.py --demo all
   ```

3. 個別デモテストの実行：
   ```
   cd python_tutorial/src/google_adk
   python main_tutorial.py --demo basic
   python main_tutorial.py --demo tool
   python main_tutorial.py --demo context
   python main_tutorial.py --demo mcp
   python main_tutorial.py --demo open_source_mcp
   ```

4. オープンソースMCP例の実行（mcp-agentパッケージがインストールされている場合）：
   ```
   cd python_tutorial/src/google_adk/examples
   python open_source_mcp_agent.py
   ```

## 5. テスト結果

### 5.1 発見された問題

| 問題ID | 問題の説明 | 影響 | 修正状況 |
|--------|-----------|------|---------|
| BUG-01 | get_context_value関数が値の代わりに辞書を返す | テストが失敗し、値を直接使用できない | 修正済み（PR #1） |
| BUG-02 | オープンソースMCP例がmcp-agentパッケージなしで実行できない | オープンソースMCP例が実行できない | 未修正（依存関係の問題） |

### 5.2 テスト結果サマリー

| テスト種類 | 実行数 | 成功数 | 失敗数 | スキップ数 |
|-----------|-------|-------|-------|----------|
| ユニットテスト | 17 | 13 | 0 | 4 |
| 統合テスト | 6 | 5 | 1 | 0 |
| エラー処理テスト | 5 | 5 | 0 | 0 |
| ドキュメントテスト | 3 | 3 | 0 | 0 |
| 合計 | 31 | 26 | 1 | 4 |

## 6. 結論と推奨事項

1. Google ADKの基本機能は正しく動作しています。
2. MCPの実装は修正後に正しく機能しています。
3. オープンソースMCP実装（lastmile-ai/mcp-agent）との統合は、パッケージがインストールされていない場合はスキップされますが、インストールされている場合は正しく機能するはずです。
4. すべてのデモシナリオは、オープンソースMCP例を除いて期待通りに動作しています。
5. エラー処理とエッジケースは適切に処理されています。
6. ドキュメントとコード例は一致しています。

### 推奨事項

1. READMEに、オープンソースMCP例を実行するためにはmcp-agentパッケージをインストールする必要があることを明記する。
2. インストール手順に、オプションの依存関係としてmcp-agentパッケージを追加する。
3. オープンソースMCP例の実行時に、より明確なエラーメッセージを表示する。
